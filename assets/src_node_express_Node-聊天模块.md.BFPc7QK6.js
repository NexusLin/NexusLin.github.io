import{_ as s,n as i,q as a,t as h}from"./chunks/theme-components.DDZ15eKn.js";import"./chunks/search-index.B-gvvmFQ.js";const n=JSON.parse('{"title":"â¤ChatèŠå¤©æ¨¡å—ï¼ˆsocket.ioçš„æ–¹å¼å®ç°ï¼‰","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"src/node/express/Node-èŠå¤©æ¨¡å—.md","filePath":"src/node/express/Node-èŠå¤©æ¨¡å—.md","lastUpdated":1748496767000}');const k=s({name:"src/node/express/Node-èŠå¤©æ¨¡å—.md"},[["render",function(s,n,k,t,l,e){return a(),i("div",null,n[0]||(n[0]=[h('<h1 id="â¤chatèŠå¤©æ¨¡å—-socket-ioçš„æ–¹å¼å®ç°" tabindex="-1">â¤ChatèŠå¤©æ¨¡å—ï¼ˆsocket.ioçš„æ–¹å¼å®ç°ï¼‰ <a class="header-anchor" href="#â¤chatèŠå¤©æ¨¡å—-socket-ioçš„æ–¹å¼å®ç°" aria-label="Permalink to &quot;â¤ChatèŠå¤©æ¨¡å—ï¼ˆsocket.ioçš„æ–¹å¼å®ç°ï¼‰&quot;">â€‹</a></h1><p>åœ°å€ï¼š<a href="https://socket.io/" target="_blank" rel="noreferrer">https://socket.io/</a></p><h2 id="_1ã€åˆ›å»ºèŠå¤©sqlè¡¨" tabindex="-1">1ã€åˆ›å»ºèŠå¤©Sqlè¡¨ <a class="header-anchor" href="#_1ã€åˆ›å»ºèŠå¤©sqlè¡¨" aria-label="Permalink to &quot;1ã€åˆ›å»ºèŠå¤©Sqlè¡¨&quot;">â€‹</a></h2><p>ç”¨äºå­˜å‚¨èŠå¤©ä¿¡æ¯è®°å½•</p><div class="language-JS vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">JS</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CREATE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> chat_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    id </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AUTO_INCREMENT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> PRIMARY</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    chat_name </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NOT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ç¾¤èŠåç§°</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    user_id </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NOT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> å‘é€è€…ID</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    user_name </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NOT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> å‘é€è€…ç”¨æˆ·å</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    avatar </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NOT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> å‘é€è€…å¤´åƒ</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    receiver_id </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NOT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> æ¥æ”¶è€…ID 0è¡¨ç¤ºç¾¤èŠ</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    message </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TEXT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NOT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,   </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> æ¶ˆæ¯å†…å®¹</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    grade </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">INT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NOT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> æ¶ˆæ¯ç­‰çº§ 0è¡¨ç¤ºæ™®é€šæ¶ˆæ¯ 1è¡¨ç¤ºç³»ç»Ÿæ¶ˆæ¯ 2è¡¨ç¤ºè­¦å‘Šæ¶ˆæ¯</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    create_time </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TIMESTAMP</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> DEFAULT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> CURRENT_TIMESTAMP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> --</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> æ¶ˆæ¯å‘é€æ—¶é—´</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h2 id="_2ã€æ­å»ºèŠå¤©å¹¶ä½¿ç”¨" tabindex="-1">2ã€æ­å»ºèŠå¤©å¹¶ä½¿ç”¨ <a class="header-anchor" href="#_2ã€æ­å»ºèŠå¤©å¹¶ä½¿ç”¨" aria-label="Permalink to &quot;2ã€æ­å»ºèŠå¤©å¹¶ä½¿ç”¨&quot;">â€‹</a></h2><p>ğŸ“Nodeç®€å•è¿æ¥mysql</p><div class="language-JS vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">JS</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;mysql&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> connection</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mysql.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createConnection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    host: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;localhost&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ•°æ®åº“ä¸»æœºåœ°å€ï¼Œå¦‚æœæ˜¯æœ¬åœ°æ•°æ®åº“åˆ™ä½¿ç”¨localhost</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    user: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;root&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ•°æ®åº“ç”¨æˆ·å</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    password: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;xxxxx&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ•°æ®åº“å¯†ç </span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    database: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;nexus&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¦è¿æ¥çš„æ•°æ®åº“å</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exports</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> connection;</span></span></code></pre></div><h2 id="" tabindex="-1">ï¼š <a class="header-anchor" href="#" aria-label="Permalink to &quot;ï¼š&quot;">â€‹</a></h2><p>æœ¬æ¥æˆ‘çš„Nodeæ˜¯åµŒå¥—åœ¨æˆ‘çš„Vite+vue3 é¡¹ç›®ä¹‹ä¸­çš„ï¼Œæœ€åå¬ä»äº†ç¾¤å‹çš„å»ºè®®ï¼Œæœ€åè¿˜æ˜¯å°†å‰åç«¯ï¼ˆä¹Ÿå°±æ˜¯vie+vue3 å¦å¤–ä¸€å¥—æ˜¯Node+mysqlè¿›è¡Œäº†åˆ†ç¦»ï¼Œè¿™é‡Œå¸Œæœ›èƒ½çœ‹åˆ°è¿™é‡Œçš„æœ‹å‹æœ€å¥½è¿›è¡Œåˆ†ç¦»ï¼Œå› ä¸ºä¸‹é¢æˆ‘ä»¬ä¸°å¯Œçš„åŠŸèƒ½è¿˜æ˜¯åˆ†å¼€å†™æ‰©å±•æ€§ä¼šæ›´åŠ çš„å¥½ï¼ï¼‰</p><h2 id="ğŸ“æŠ¥é”™å¤„ç†" tabindex="-1">ğŸ“æŠ¥é”™å¤„ç† <a class="header-anchor" href="#ğŸ“æŠ¥é”™å¤„ç†" aria-label="Permalink to &quot;ğŸ“æŠ¥é”™å¤„ç†&quot;">â€‹</a></h2><h3 id="æŠ¥é”™-websocketserver-is-not-a-constructor" tabindex="-1">æŠ¥é”™ï¼šWebSocketServer is not a constructor <a class="header-anchor" href="#æŠ¥é”™-websocketserver-is-not-a-constructor" aria-label="Permalink to &quot;æŠ¥é”™ï¼šWebSocketServer is not a constructor&quot;">â€‹</a></h3><div class="language-JS vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">JS</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TypeError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: WebSocket.WebSocketServer is not a constructor</span></span></code></pre></div><p>ä¸€ç›´æç¤ºæˆ‘ä»¬ <code>WebSocket.WebSocketServer is not a constructor</code></p><p>è¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ</p><h4 id="è§£å†³websocketæ›´æ–°æŠ¥é”™" tabindex="-1">è§£å†³websocketæ›´æ–°æŠ¥é”™ <a class="header-anchor" href="#è§£å†³websocketæ›´æ–°æŠ¥é”™" aria-label="Permalink to &quot;è§£å†³websocketæ›´æ–°æŠ¥é”™&quot;">â€‹</a></h4><p>è¿™æ˜¯å› ä¸ºNode.js çš„æœ€æ–°ç‰ˆæœ¬åœ¨WebSocket å¤„ç†ç½‘ç»œåè®®å¦‚ WebSocket æ–¹é¢å¯¹ä½¿ç”¨ Node.js 20 + Vite åšäº†ä¸€äº›æ›´æ”¹æ‰€ä»¥å¯¼è‡´äº†æˆ‘ä»¬ä¸Šé¢çš„æŠ¥é”™</p><p>ä» Node.js 15èµ·ï¼ŒNode.js è®©æˆ‘ä»¬ä½¿ç”¨å†…ç½®çš„ <code>http</code> å’Œ <code>https</code> æ¨¡å—ç›´æ¥æ”¯æŒ WebSocketï¼Œè€Œä¸æ˜¯ä¾èµ–ç¬¬ä¸‰æ–¹åº“ã€‚å¼•å…¥äº†å®éªŒæ€§çš„ <code>http/websocket</code> æ¨¡å—æ¥æä¾›åŸç”Ÿçš„ WebSocket æ”¯æŒï¼ˆ<code>ç®€å•æ€»ç»“å°±æ˜¯ä¸€å¥è¯ï¼Œç‰ˆæœ¬æ›´æ–°äº†ï¼Œå†™æ³•å˜äº†</code>ï¼‰</p><h4 id="æ–°å†™æ³•" tabindex="-1">æ–°å†™æ³• <a class="header-anchor" href="#æ–°å†™æ³•" aria-label="Permalink to &quot;æ–°å†™æ³•&quot;">â€‹</a></h4><p>å°è¯•æ–°çš„å†™æ³•æ–¹å¼ä½¿ç”¨å†…ç½®çš„ <code>http/websocket</code> æ¨¡å—ï¼š</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { WebSocketServer } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;http/websocket&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> wss</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WebSocketServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ port: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wss.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;connection&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> connection</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ws</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ws.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;message&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;received: %s&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, data);</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ws.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;something&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div>',21)]))}]]);export{n as __pageData,k as default};
