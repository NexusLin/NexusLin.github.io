import{s as k,B as se,r as s,f as re,g as ie,o as ue,c as I,a as b,b as l,h as a,u as n,i as r,l as de,v as pe,F as P,d as D,k as m,t as ce,m as me,x as w,C,n as v,E as M,q as fe,e as c}from"./index-B_mAkUH5.js";import{l as ge}from"./activities-CgjWfV5g.js";import{l as ve}from"./user-B0LFSwAl.js";function _e(p){return k({url:"/applications",method:"get",params:p})}function ye(p){return k({url:"/applications/"+p,method:"get"})}function be(p){return k({url:"/applications",method:"post",data:p})}function we(p){return k({url:"/applications",method:"put",data:p})}function xe(p){return k({url:"/applications/"+p,method:"delete"})}function he(p,V){return k({url:"/applications/status/"+p,method:"put",data:V})}const ke={class:"compage page-articlelist"},Ve={class:"bcbox search"},Ce={class:"bcbox"},Ie={class:"bcbox"},Ae={class:"image-slot"},Ue={style:{display:"flex",gap:"4px","justify-content":"center"}},Be={class:"dialog-footer",style:{"text-align":"center"}},Pe=se({__name:"application",setup(p){fe();const V=s();s([]);const O=re({form:{},queryParams:{pageNum:1,pageSize:10,name:"",age:"",sex:1},rules:{activityId:[{required:!0,message:"活动不能为空",trigger:"change"}],userId:[{required:!0,message:"用户不能为空",trigger:"change"}],title:[{required:!0,message:"标题不能为空",trigger:"blur"}],description:[{required:!0,message:"内容不能为空",trigger:"blur"}],type:[{required:!0,message:"类型不能为空",trigger:"change"}]}}),{queryParams:d,form:f,rules:Q}=ie(O),F=s([]),x=s(!1),A=s("");s(1),s(10),s(!1),s(!1),s(!1),s(!1),s([]);const $=s(!0),U=s(0);ue(()=>{j(),N()});const B=s([]),z=s([]);function N(){ge().then(o=>{B.value=o.data})}function T(){ve().then(o=>{z.value=o.data})}const G=async(o,e)=>{o&&await o.validate((i,g)=>{i?f.value.id!=null?we(f.value).then(u=>{u.code==200?v.success(u.message):v.error(u.message),x.value=!1,h()}):(f.value.status="pending",be(f.value).then(u=>{u.code==200?v.success(u.message):v.error(u.message),x.value=!1,h()})):console.log("error submit!",g)})};function j(){d.value.pageNum=1,h()}function h(){$.value=!0,_e(d.value).then(o=>{F.value=o.data,U.value=o.total,$.value=!1})}function H(o){console.log(o),N(),T(),ye(o).then(e=>{e.code==200?(f.value=e.data,x.value=!0):v.error(e.message)})}function J(){X(V.value),N(),T(),x.value=!0,A.value="添加",console.log("新增")}function K(o){A.value="修改",H(o.id)}const W=async o=>{const e=o.id||e.value;M.confirm("是否确认删除选中的数据项？","系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{xe(e).then(i=>{i.code==200?(v.success(i.message),h()):v.error(i.message)})}).catch(()=>{})};function R(o,e){let i=e=="approved"?"同意":"拒绝";M.confirm(`确认要${i}吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{he(o.id,{status:e}).then(function(g){g.code==200?(v.success(g.message),h()):(v.error(g.message),h())})}).catch(()=>{})}const X=o=>{o&&o.resetFields()};return(o,e)=>{const i=r("el-option"),g=r("el-select"),u=r("el-form-item"),Y=r("el-input"),_=r("el-button"),E=r("el-form"),Z=r("el-col"),ee=r("el-row"),y=r("el-table-column"),te=r("Picture"),L=r("el-icon"),le=r("el-image"),S=r("el-tag"),ae=r("el-table"),oe=r("Pagination"),ne=r("el-dialog");return c(),I("div",ke,[b("div",Ve,[l(E,{model:n(d),ref:"queryForm",inline:!0,"label-width":"70px"},{default:a(()=>[l(u,{label:"活动名称"},{default:a(()=>[l(g,{modelValue:n(d).activityId,"onUpdate:modelValue":e[0]||(e[0]=t=>n(d).activityId=t),placeholder:"请选择"},{default:a(()=>[(c(!0),I(P,null,D(B.value,t=>(c(),w(i,{key:t.id,label:t.title,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"用户ID"},{default:a(()=>[l(Y,{modelValue:n(d).userId,"onUpdate:modelValue":e[1]||(e[1]=t=>n(d).userId=t),placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1}),l(u,{label:"活动状态"},{default:a(()=>[l(g,{modelValue:n(d).status,"onUpdate:modelValue":e[2]||(e[2]=t=>n(d).status=t),placeholder:"请选择",clearable:""},{default:a(()=>[l(i,{label:"等待审核",value:"pending"}),l(i,{label:"审核通过",value:"approved"}),l(i,{label:"审核失败",value:"rejected"})]),_:1},8,["modelValue"])]),_:1}),l(u,null,{default:a(()=>[l(_,{type:"primary",icon:"Search",onClick:j},{default:a(()=>e[10]||(e[10]=[m("搜索")])),_:1})]),_:1})]),_:1},8,["model"])]),b("div",Ce,[l(ee,{gutter:10,class:"mb8"},{default:a(()=>[l(Z,{span:1.5},{default:a(()=>[l(_,{type:"primary",plain:"",icon:"Plus",onClick:J},{default:a(()=>e[11]||(e[11]=[m("新增")])),_:1})]),_:1})]),_:1})]),b("div",Ie,[l(ae,{border:!1,data:F.value,stripe:"",style:{width:"100%"},"max-height":"540"},{default:a(()=>[l(y,{type:"selection",width:"80"}),l(y,{label:"申请ID",align:"center",prop:"id",width:"170"}),l(y,{label:"申请活动",align:"center",prop:"activityTitle","show-overflow-tooltip":!0}),l(y,{label:"申请用户",align:"center",prop:"userName","show-overflow-tooltip":!0},{default:a(t=>[b("span",null,ce(t.row.userName),1)]),_:1}),l(y,{label:"申请用户ID",align:"center",prop:"userId","show-overflow-tooltip":!0}),l(y,{label:"用户头像",align:"center",prop:"userAvatar","show-overflow-tooltip":!0,width:"300"},{default:a(t=>[b("div",null,[l(le,{style:{width:"50px",height:"50px"},src:n(me).baseURL+t.row.userAvatar,fit:"contain"},{error:a(()=>[b("div",Ae,[l(L,null,{default:a(()=>[l(L,null,{default:a(()=>[l(te)]),_:1})]),_:1})])]),_:2},1032,["src"])])]),_:1}),l(y,{label:"状态",align:"center",key:"status"},{default:a(t=>[t.row.status=="pending"?(c(),w(S,{key:0,style:{cursor:"pointer"},type:"info"},{default:a(()=>e[12]||(e[12]=[m("等待审核")])),_:1})):C("",!0),t.row.status=="approved"?(c(),w(S,{key:1,style:{cursor:"pointer"},type:"success"},{default:a(()=>e[13]||(e[13]=[m("审核通过")])),_:1})):C("",!0),t.row.status=="rejected"?(c(),w(S,{key:2,style:{cursor:"pointer"},type:"warning"},{default:a(()=>e[14]||(e[14]=[m("审核拒绝")])),_:1})):C("",!0)]),_:1}),l(y,{fixed:"right",label:"操作",width:"380"},{default:a(t=>[b("div",Ue,[l(_,{type:"success",plain:"",onClick:q=>K(t.row)},{default:a(()=>e[15]||(e[15]=[m("修改")])),_:2},1032,["onClick"]),l(_,{type:"danger",plain:"",onClick:q=>W(t.row)},{default:a(()=>e[16]||(e[16]=[m("删除")])),_:2},1032,["onClick"]),t.row.status=="pending"||t.row.status=="rejected"?(c(),w(_,{key:0,type:"info",plain:"",onClick:q=>R(t.row,"approved")},{default:a(()=>e[17]||(e[17]=[m("同意审核")])),_:2},1032,["onClick"])):C("",!0),t.row.status=="pending"||t.row.status=="approved"?(c(),w(_,{key:1,type:"warning",plain:"",onClick:q=>R(t.row,"rejected")},{default:a(()=>e[18]||(e[18]=[m("拒绝审核")])),_:2},1032,["onClick"])):C("",!0)])]),_:1})]),_:1},8,["data"]),de(l(oe,{total:U.value,"current-page":n(d).pageNum,"onUpdate:currentPage":e[3]||(e[3]=t=>n(d).pageNum=t),"page-size":n(d).pageSize,"onUpdate:pageSize":e[4]||(e[4]=t=>n(d).pageSize=t),onPagination:h},null,8,["total","current-page","page-size"]),[[pe,U.value>0]])]),l(ne,{modelValue:x.value,"onUpdate:modelValue":e[9]||(e[9]=t=>x.value=t),title:A.value,width:"980px",class:"article",style:{padding:"10px 50px","margin-top":"8vh"},draggable:""},{footer:a(()=>[b("div",Be,[l(_,{onClick:e[7]||(e[7]=t=>x.value=!1)},{default:a(()=>e[19]||(e[19]=[m("取 消")])),_:1}),l(_,{type:"primary",onClick:e[8]||(e[8]=t=>G(V.value))},{default:a(()=>e[20]||(e[20]=[m("确认")])),_:1})])]),default:a(()=>[l(E,{ref_key:"ruleFormRef",ref:V,model:n(f),rules:n(Q),"label-width":"100px"},{default:a(()=>[l(u,{label:"活动",prop:"activityId"},{default:a(()=>[l(g,{modelValue:n(f).activityId,"onUpdate:modelValue":e[5]||(e[5]=t=>n(f).activityId=t),placeholder:"请选择"},{default:a(()=>[(c(!0),I(P,null,D(B.value,t=>(c(),w(i,{key:t.id,label:t.title,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"用户",prop:"userId"},{default:a(()=>[l(g,{modelValue:n(f).userId,"onUpdate:modelValue":e[6]||(e[6]=t=>n(f).userId=t),placeholder:"请选择"},{default:a(()=>[(c(!0),I(P,null,D(z.value,t=>(c(),w(i,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{Pe as default};
