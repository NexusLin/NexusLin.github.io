import{_ as a,c as i,ag as n,o as p}from"./chunks/framework.Bft4-MjQ.js";const E=JSON.parse('{"title":"NestJS-bcryptåŠ å¯†è§£å¯†ä½¿ç”¨","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"src/node/nest/NestJS-bcryptåŠ å¯†.md","filePath":"src/node/nest/NestJS-bcryptåŠ å¯†.md"}'),t={name:"src/node/nest/NestJS-bcryptåŠ å¯†.md"};function l(e,s,h,k,r,d){return p(),i("div",null,s[0]||(s[0]=[n(`<h1 id="nestjs-bcryptåŠ å¯†è§£å¯†ä½¿ç”¨" tabindex="-1">NestJS-bcryptåŠ å¯†è§£å¯†ä½¿ç”¨ <a class="header-anchor" href="#nestjs-bcryptåŠ å¯†è§£å¯†ä½¿ç”¨" aria-label="Permalink to &quot;NestJS-bcryptåŠ å¯†è§£å¯†ä½¿ç”¨&quot;">â€‹</a></h1><h2 id="_1ã€è®¤è¯†å®‰è£…" tabindex="-1">1ã€è®¤è¯†å®‰è£… <a class="header-anchor" href="#_1ã€è®¤è¯†å®‰è£…" aria-label="Permalink to &quot;1ã€è®¤è¯†å®‰è£…&quot;">â€‹</a></h2><p>åœ¨ NestJS ä¸­ä½¿ç”¨ <code>bcrypt</code> æ¥è¿›è¡Œå¯†ç å“ˆå¸Œå’ŒéªŒè¯æ˜¯éå¸¸å¸¸è§çš„éœ€æ±‚ã€‚<code>bcrypt</code> æ˜¯ä¸€ä¸ªå®‰å…¨çš„å“ˆå¸Œç®—æ³•ï¼Œå®ƒå¯ä»¥ç”¨äºåŠ å¯†ç”¨æˆ·å¯†ç ï¼Œå¹¶ä¸”æä¾›äº†éªŒè¯å¯†ç æ˜¯å¦åŒ¹é…çš„åŠŸèƒ½ã€‚</p><h3 id="ğŸ‘‰å®‰è£…-bcrypt" tabindex="-1">ğŸ‘‰å®‰è£… <code>bcrypt</code> <a class="header-anchor" href="#ğŸ‘‰å®‰è£…-bcrypt" aria-label="Permalink to &quot;ğŸ‘‰å®‰è£… \`bcrypt\`&quot;">â€‹</a></h3><p>é¦–å…ˆï¼Œä½ éœ€è¦å®‰è£… <code>bcrypt</code> åº“ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š</p><div class="language-plain vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">plain</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>npm install bcrypt</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// è¿™é‡Œæˆ‘ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯ &quot;bcrypt&quot;: &quot;^5.1.1&quot;,</span></span></code></pre></div><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ TypeScriptï¼Œ<code>bcrypt</code> å¯èƒ½è¿˜éœ€è¦å®‰è£…ç±»å‹å®šä¹‰æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘çš„</p><div class="language-plain vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">plain</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>npm install @types/bcrypt --save-dev</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>//yarnæ–¹å¼å®‰è£…</span></span>
<span class="line"><span>yarn add @types/bcrypt --save-dev</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// ç‰ˆæœ¬</span></span>
<span class="line"><span>&quot;@types/bcrypt&quot;: &quot;^5.0.2&quot;,</span></span></code></pre></div><h2 id="_2ã€ä½¿ç”¨-bcrypt" tabindex="-1">2ã€ä½¿ç”¨ <code>bcrypt</code> <a class="header-anchor" href="#_2ã€ä½¿ç”¨-bcrypt" aria-label="Permalink to &quot;2ã€ä½¿ç”¨ \`bcrypt\`&quot;">â€‹</a></h2><h3 id="ğŸ‘‰ä½œç”¨" tabindex="-1">ğŸ‘‰ä½œç”¨ <a class="header-anchor" href="#ğŸ‘‰ä½œç”¨" aria-label="Permalink to &quot;ğŸ‘‰ä½œç”¨&quot;">â€‹</a></h3><p>æ²¡æœ‰ç»è¿‡åŠ å¯†ä¹‹å‰æˆ‘ä»¬çš„å¯†ç æ˜¯è¿™æ ·çš„</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1111111111</span></span></code></pre></div><p>åŠ å¯†ä»¥åæˆ‘ä»¬çš„å¯†ç </p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$10$D1L8Dh3L1NKTUaJsvr.7r.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dm6p19ix7e7ZwctuMZ1KzdTbEk1muO</span></span></code></pre></div><p>ä¹‹å‰æˆ‘ä»¬çš„å¯†ç éƒ½æ˜¯æ˜æ–‡å­˜å‚¨çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±åŠ å¯†è§£å¯†å¯¹äºå¯†ç è¿›è¡ŒéªŒè¯</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user.password </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> registerDto.password;</span></span></code></pre></div><h3 id="ğŸ‘‰æ³¨å†Œè¿ç§»åˆ°authæ¨¡å—" tabindex="-1">ğŸ‘‰æ³¨å†Œè¿ç§»åˆ°authæ¨¡å— <a class="header-anchor" href="#ğŸ‘‰æ³¨å†Œè¿ç§»åˆ°authæ¨¡å—" aria-label="Permalink to &quot;ğŸ‘‰æ³¨å†Œè¿ç§»åˆ°authæ¨¡å—&quot;">â€‹</a></h3><p>ä¹‹å‰æˆ‘ä»¬æ³¨å†Œæ¨¡å—åœ¨useræ¨¡å—ä¹‹ä¸­ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¿ç§»åˆ°authæˆæƒæ¨¡å—</p><h5 id="auth-controller-ts" tabindex="-1">auth.controller.ts <a class="header-anchor" href="#auth-controller-ts" aria-label="Permalink to &quot;auth.controller.ts&quot;">â€‹</a></h5><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { RegisterDto } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@/utils/response.dto&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Post</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;register&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() registerDto: RegisterDto) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.authService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(registerDto);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span></code></pre></div><h5 id="auth-module-tså¼•å…¥ç”¨æˆ·å®ä½“" tabindex="-1">auth.module.tså¼•å…¥ç”¨æˆ·å®ä½“ <a class="header-anchor" href="#auth-module-tså¼•å…¥ç”¨æˆ·å®ä½“" aria-label="Permalink to &quot;auth.module.tså¼•å…¥ç”¨æˆ·å®ä½“&quot;">â€‹</a></h5><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { TypeOrmModule } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@nestjs/typeorm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { User } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@/modules/user/user.entity&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Module</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  imports: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    TypeOrmModule.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forFeature</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([User]),  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ³¨å†Œ User å®ä½“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  providers: [AuthService, JwtStrategy],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  controllers: [AuthController],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AuthModule</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span></code></pre></div><h5 id="auth-service-ts" tabindex="-1">auth.service.ts <a class="header-anchor" href="#auth-service-ts" aria-label="Permalink to &quot;auth.service.ts&quot;">â€‹</a></h5><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { InjectRepository } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@nestjs/typeorm&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { RegisterDto } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@/utils/response.dto&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { User } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@/modules/user/user.entity&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¼‚æ­¥æ³¨å†Œæ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  async </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(registerDto: RegisterDto) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æŸ¥è¯¢æ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨åŒåç”¨æˆ·</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> existingUser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.userRepository.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">findOne</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ where: { username: registerDto.username } });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å¦‚æœå­˜åœ¨åŒåç”¨æˆ·ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (existingUser) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      versionhello</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ç”¨æˆ·æ³¨å†Œæç¤º&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ç”¨æˆ·å·²å­˜åœ¨!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // throw new ConflictException(&#39;ç”¨æˆ·å·²å­˜åœ¨ï¼&#39;);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // return {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      //   data: [],</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      //   message: &#39;ç”¨æˆ·å·²å­˜åœ¨ï¼&#39;,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      //   code: 400,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // };</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HttpException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          code: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é€‚å½“çš„é”™è¯¯ç æ˜¯ 400</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          message: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ç”¨æˆ·å·²å­˜åœ¨ï¼&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        HttpStatus.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BAD_REQUEST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä½¿ç”¨ 400 çŠ¶æ€ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // åˆ›å»ºæ–°ç”¨æˆ·</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    user.username </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> registerDto.username;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    user.password </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> registerDto.password;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // user.password = hashedPassword;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> savedUser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.userRepository.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">save</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(user); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä¿å­˜åˆ°æ•°æ®åº“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(savedUser, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;savedUser&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è¿”å›æ³¨å†ŒæˆåŠŸçš„ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      message: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;æ­å–œä½ ï¼Œæ‚¨çš„è´¦å·æ³¨å†ŒæˆåŠŸï¼&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      code: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span></code></pre></div><h2 id="_3ã€åŠ å¯†è§£å¯†" tabindex="-1">3ã€åŠ å¯†è§£å¯† <a class="header-anchor" href="#_3ã€åŠ å¯†è§£å¯†" aria-label="Permalink to &quot;3ã€åŠ å¯†è§£å¯†&quot;">â€‹</a></h2><h3 id="ğŸ‘‰åŠ å¯†" tabindex="-1">ğŸ‘‰åŠ å¯† <a class="header-anchor" href="#ğŸ‘‰åŠ å¯†" aria-label="Permalink to &quot;ğŸ‘‰åŠ å¯†&quot;">â€‹</a></h3><p>æ­£ç¡®å¼•å…¥è¿ç§»ä»¥åï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥é’ˆå¯¹å¯†ç è¿›è¡ŒåŠ å¯†å’Œè§£å¯†äº†</p><p>åŠ å¯†</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//å¯¼å…¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bcrypt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;bcrypt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">async </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hashPassword</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(password: string): </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Promise</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">string</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  const salt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bcrypt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">genSalt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç”Ÿæˆ salt</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  const hashedPassword </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bcrypt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(password, salt);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç”¨ salt åŠ å¯†å¯†ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  return hashedPassword;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åŠ å¯†å¯†ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> hashedPassword</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hashPassword</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(registerDto.password);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//ç›´æ¥ä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user.password </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hashedPassword;</span></span></code></pre></div><p>åŠ å¯†ä»¥åå¾—å¯†ç </p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$2b$10$D1L8Dh3L1NKTUaJsvr.7r.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dm6p19ix7e7ZwctuMZ1KzdTbEk1muO</span></span></code></pre></div><h3 id="ğŸ‘‰è§£å¯†" tabindex="-1">ğŸ‘‰è§£å¯† <a class="header-anchor" href="#ğŸ‘‰è§£å¯†" aria-label="Permalink to &quot;ğŸ‘‰è§£å¯†&quot;">â€‹</a></h3><p>åŠ å¯†å®Œä»¥åè¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„å¯†ç å·²ç»å…¥åº“ï¼Œæ¥ä¸‹æ¥åœ¨è§£å¯†éƒ¨åˆ†åç¿»è¯‘å‡ºå¯†ç å¯¹æ¯”ï¼Œè¿™éƒ¨åˆ†åœ¨ç™»å½•è¿™é‡Œå®ç°</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // éªŒè¯å¯†ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> async </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">validatePassword</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(password: string, hashedPassword: string): </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Promise</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">boolean</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    const isMatch </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bcrypt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">compare</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(password, hashedPassword);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¯”è¾ƒå¯†ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    return isMatch;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span></code></pre></div><h5 id="å®Œå–„auth-service-ts" tabindex="-1">å®Œå–„auth.service.ts <a class="header-anchor" href="#å®Œå–„auth-service-ts" aria-label="Permalink to &quot;å®Œå–„auth.service.ts&quot;">â€‹</a></h5><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//å¯¹æ¯”å¯†ç </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isPasswordValid</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">validatePassword</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LoginDto.password, loginUser.password);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//ç®€å•å¯¹æ¯”ä¸€ä¸‹ç”¨æˆ·çš„è´¦å·å¯†ç ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(isPasswordValid){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      message: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ç™»å½•æˆåŠŸï¼&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      code: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      token: token,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      message: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      code: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span></code></pre></div><h2 id="_4ã€å®Œæ•´ç¤ºä¾‹" tabindex="-1">4ã€å®Œæ•´ç¤ºä¾‹ <a class="header-anchor" href="#_4ã€å®Œæ•´ç¤ºä¾‹" aria-label="Permalink to &quot;4ã€å®Œæ•´ç¤ºä¾‹&quot;">â€‹</a></h2><p>æ•´ä¸ªè¿‡ç¨‹</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">æ³¨å†Œæ—¶åŠ å¯†å¯†ç ï¼šæ³¨å†Œæ—¶ï¼Œä½¿ç”¨ bcrypt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() åŠ å¯†å¯†ç ï¼Œä¸ç›å€¼ä¸€èµ·ç”Ÿæˆå“ˆå¸Œå¯†ç ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ç™»å½•æ—¶éªŒè¯å¯†ç ï¼šç™»å½•æ—¶ï¼Œä½¿ç”¨ bcrypt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">compare</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() æ–¹æ³•æ¯”è¾ƒè¾“å…¥çš„å¯†ç å’Œæ•°æ®åº“ä¸­å­˜å‚¨çš„å“ˆå¸Œå¯†ç ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ç›å€¼çš„è½®æ•°ï¼šbcrypt.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">genSalt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() æ–¹æ³•çš„ saltRounds å‚æ•°æ§åˆ¶äº†ç”Ÿæˆç›å€¼çš„å¤æ‚åº¦</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  å¸¸è§çš„å€¼æ˜¯ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,å¦‚æœéœ€è¦æ›´å¼ºçš„åŠ å¯†ï¼Œå¯ä»¥å¢åŠ è¯¥å€¼ã€‚</span></span></code></pre></div><p>å®Œæ•´çš„ç”¨æˆ·æ³¨å†Œæ—¶ä½¿ç”¨ <code>bcrypt</code> å¯¹ç”¨æˆ·å¯†ç è¿›è¡ŒåŠ å¯†</p><p>åœ¨æœåŠ¡å±‚ï¼ˆå¦‚ <code>AuthService</code>ï¼‰ä¸­å¤„ç†å¯†ç çš„åŠ å¯†å’ŒéªŒè¯</p><h3 id="ğŸ‘‰ç¤ºä¾‹" tabindex="-1">ğŸ‘‰ç¤ºä¾‹ <a class="header-anchor" href="#ğŸ‘‰ç¤ºä¾‹" aria-label="Permalink to &quot;ğŸ‘‰ç¤ºä¾‹&quot;">â€‹</a></h3><p><code>AuthService</code> ä¸­ä½¿ç”¨ <code>bcrypt</code></p><p><code>auth.service.ts</code> (åŠ å¯†å’ŒéªŒè¯å¯†ç )</p><div class="language-plain vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">plain</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>typescriptCopy Codeimport { Injectable } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span>import * as bcrypt from &#39;bcrypt&#39;;</span></span>
<span class="line"><span>import { RegisterDto } from &#39;./dto/register.dto&#39;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>@Injectable()</span></span>
<span class="line"><span>export class AuthService {</span></span>
<span class="line"><span>  private readonly saltRounds = 10; // åŠ å¯†çš„ç›å€¼è½®æ•°ï¼Œé€šå¸¸è®¾ä¸º10æˆ–æ›´é«˜</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  // åŠ å¯†å¯†ç </span></span>
<span class="line"><span>  async hashPassword(password: string): Promise&lt;string&gt; {</span></span>
<span class="line"><span>    const salt = await bcrypt.genSalt(this.saltRounds); // ç”Ÿæˆç›å€¼</span></span>
<span class="line"><span>    return await bcrypt.hash(password, salt);  // ç”ŸæˆåŠ å¯†å¯†ç </span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  // éªŒè¯å¯†ç </span></span>
<span class="line"><span>  async validatePassword(password: string, hashedPassword: string): Promise&lt;boolean&gt; {</span></span>
<span class="line"><span>    return await bcrypt.compare(password, hashedPassword);  // æ¯”è¾ƒåŸå¯†ç å’Œå“ˆå¸Œå¯†ç </span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  // ç”¨æˆ·æ³¨å†Œçš„é€»è¾‘</span></span>
<span class="line"><span>  async register(registerDto: RegisterDto): Promise&lt;string&gt; {</span></span>
<span class="line"><span>    const { password } = registerDto;</span></span>
<span class="line"><span>    const hashedPassword = await this.hashPassword(password);  // å°†å¯†ç åŠ å¯†</span></span>
<span class="line"><span>    // å‡è®¾ä¿å­˜ç”¨æˆ·æ•°æ®åˆ°æ•°æ®åº“ï¼Œé€šå¸¸ä¼šåœ¨è¿™é‡Œè°ƒç”¨ Repository æˆ– ORM æ–¹æ³•ä¿å­˜</span></span>
<span class="line"><span>    console.log(&#39;Hashed Password:&#39;, hashedPassword);</span></span>
<span class="line"><span>    return &#39;User registered successfully&#39;;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p><code>register.dto.ts</code></p><div class="language-plain vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">plain</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>typescriptCopy Codeimport { IsString, IsEmail, IsNotEmpty, MinLength } from &#39;class-validator&#39;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>export class RegisterDto {</span></span>
<span class="line"><span>  @IsString()</span></span>
<span class="line"><span>  @IsNotEmpty()</span></span>
<span class="line"><span>  @MinLength(3)</span></span>
<span class="line"><span>  username: string;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  @IsEmail()</span></span>
<span class="line"><span>  @IsNotEmpty()</span></span>
<span class="line"><span>  email: string;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  @IsString()</span></span>
<span class="line"><span>  @IsNotEmpty()</span></span>
<span class="line"><span>  @MinLength(6)</span></span>
<span class="line"><span>  password: string;</span></span>
<span class="line"><span>}</span></span></code></pre></div><p><code>auth.controller.ts</code> (ä½¿ç”¨ <code>AuthService</code>)</p><div class="language-plain vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">plain</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>typescriptCopy Codeimport { Body, Controller, Post } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span>import { AuthService } from &#39;./auth.service&#39;;</span></span>
<span class="line"><span>import { RegisterDto } from &#39;./dto/register.dto&#39;;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>@Controller(&#39;auth&#39;)</span></span>
<span class="line"><span>export class AuthController {</span></span>
<span class="line"><span>  constructor(private readonly authService: AuthService) {}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  @Post(&#39;register&#39;)</span></span>
<span class="line"><span>  async register(@Body() registerDto: RegisterDto) {</span></span>
<span class="line"><span>    return await this.authService.register(registerDto);  // è°ƒç”¨ AuthService ä¸­çš„ register æ–¹æ³•</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre></div><ol start="3"><li>ä½¿ç”¨ <code>bcrypt</code> éªŒè¯å¯†ç </li></ol><p>åœ¨ç”¨æˆ·ç™»å½•æ—¶ï¼Œä½ ä¼šéœ€è¦å°†ç”¨æˆ·è¾“å…¥çš„å¯†ç ä¸æ•°æ®åº“ä¸­å­˜å‚¨çš„å“ˆå¸Œå¯†ç è¿›è¡Œæ¯”è¾ƒã€‚è¿™æ˜¯é€šè¿‡ <code>bcrypt.compare()</code> æ–¹æ³•æ¥å®ç°çš„ï¼Œå®ƒä¼šå¯¹è¾“å…¥çš„å¯†ç è¿›è¡Œå“ˆå¸Œå¹¶ä¸å­˜å‚¨çš„å“ˆå¸Œè¿›è¡Œæ¯”è¾ƒã€‚</p><p>åœ¨ä¸Šé¢çš„ <code>AuthService</code> ä¸­ï¼Œå·²ç»æä¾›äº†ä¸€ä¸ª <code>validatePassword</code> æ–¹æ³•æ¥éªŒè¯å¯†ç æ˜¯å¦æ­£ç¡®ã€‚è¿™ä¸ªæ–¹æ³•ä½¿ç”¨ <code>bcrypt.compare()</code> æ¥æ¯”è¾ƒè¾“å…¥å¯†ç å’Œå“ˆå¸Œå¯†ç ã€‚</p><p>åœ¨ <code>AuthService</code> ä¸­éªŒè¯å¯†ç </p><div class="language-plain vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">plain</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>typescriptCopy Code// åœ¨ AuthService ä¸­éªŒè¯å¯†ç </span></span>
<span class="line"><span>async login(loginDto: LoginDto): Promise&lt;string&gt; {</span></span>
<span class="line"><span>  const { email, password } = loginDto;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  // å‡è®¾ä»æ•°æ®åº“ä¸­è·å–ç”¨æˆ·çš„å“ˆå¸Œå¯†ç </span></span>
<span class="line"><span>  const user = await this.userRepository.findOne({ where: { email } });</span></span>
<span class="line"><span>  if (!user) {</span></span>
<span class="line"><span>    throw new Error(&#39;User not found&#39;);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  // ä½¿ç”¨ bcrypt æ¯”è¾ƒå¯†ç </span></span>
<span class="line"><span>  const isPasswordValid = await this.validatePassword(password, user.password);</span></span>
<span class="line"><span>  if (!isPasswordValid) {</span></span>
<span class="line"><span>    throw new Error(&#39;Invalid credentials&#39;);</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  return &#39;Login successful&#39;;</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>é€šè¿‡ä»¥ä¸Šæ–¹æ³•ï¼ŒNestJS ä¸­å°±èƒ½å®‰å…¨åœ°åŠ å¯†å’ŒéªŒè¯ç”¨æˆ·çš„å¯†ç äº†ã€‚</p>`,55)]))}const o=a(t,[["render",l]]);export{E as __pageData,o as default};
