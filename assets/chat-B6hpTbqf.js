import{_ as w,D as S,r as c,o as T,m as N,w as C,G as W,c as i,a as e,F as B,d as D,l as F,H as M,n as j,e as d,t as p,I as E}from"./index-B_mAkUH5.js";import{u as L,_ as y}from"./user-C6RCANnn.js";import{l as U}from"./chat-CCx4LQA3.js";import"./login-D_PYrTNz.js";const z={class:"page-chat chat-container"},J={class:"chatbody"},K={class:"chatmodule",style:{padding:"20px"}},O={key:0,class:"chatmoduleli",style:{display:"flex","justify-content":"flex-end",width:"100%"}},V={class:"chatr",style:{"max-width":"calc(70% - 60px)"}},G={class:"chath2",style:{color:"#ccc","font-size":"18px","text-align":"right"}},H={class:"chattext",style:{"background-color":"#1890FF","border-radius":"8px",padding:"10px 20px",color:"#fff"}},P={key:1,class:"chatmoduleli",style:{display:"flex","justify-content":"flex-start",width:"100%"}},q={class:"chatr",style:{"max-width":"calc(70% - 60px)"}},A={class:"chath2",style:{color:"#ccc","font-size":"18px"}},Q={class:"chattext",style:{"background-color":"#fff","border-radius":"8px",padding:"10px 20px"}},R={class:"chatfoot"},X={class:"footleft",style:{flex:"1"}},Y={__name:"chat",setup(Z){const a=L();console.log("userInfo.userId",a.userId),console.log("userInfo.userId",a.name),console.log("userInfo.avatar",a.avatar);const v=S(()=>a.userId),n=c(null);c(!1),c(0);let u=null,f=0;T(async()=>{try{await m(),await _(),console.log("WebSocket connected and userId set:",v.value)}catch(s){console.error("Failed to connect WebSocket or fetch user data:",s)}});const o=c(null),x=c([]),h=c([]),r=c(""),_=()=>{o.value=new WebSocket(N.wschaturl),o.value.onopen=()=>{console.log("Connected to WebSocket server")},o.value.onmessage=s=>{const t=JSON.parse(s.data);t.type=="chatmsg"&&(console.log(t.data,"群聊信息"),h.value.push(t.data))},o.value.onclose=()=>{console.log("Disconnected from WebSocket server")}},g=()=>{if(r.value.trim()){const s={type:"chatmsg",data:{userId:a.userId,userName:a.name,avatar:a.avatar,chatName:"群聊",receiverId:0,content:r.value,grade:0,createTime:"2024-12-30"}};o.value.send(JSON.stringify(s)),x.value.push(s.data),r.value="",m()}else j({type:"info",message:"请输入聊天信息"})},k=s=>{s.key==="Enter"&&g()},m=()=>{U().then(s=>{console.log(s,"response"),h.value=s.data})};C(()=>h.value.length,(s,t)=>{s>t&&I()});const I=()=>{console.log("滑动到底部🔪"),E(()=>{n.value&&(u=setInterval(()=>{n.value.scrollTop+=1e3,n.value.scrollTop===f?(console.log("滚动停止，清除定时器"),clearInterval(u)):f=n.value.scrollTop},10))})};return W(()=>{o.value&&o.value.close(),u&&clearInterval(u)}),(s,t)=>(d(),i("div",z,[t[3]||(t[3]=e("div",{class:"chathead"},[e("h1",null,"Chat")],-1)),e("div",J,[e("div",{id:"chat-box",class:"chat-box",ref_key:"chatContainer",ref:n},[(d(!0),i(B,null,D(h.value,(l,b)=>(d(),i("div",{key:b,class:"message"},[e("div",K,[l.userId==v.value?(d(),i("div",O,[e("div",V,[e("div",G,p(l.userName),1),e("div",H,p(l.content),1)]),t[1]||(t[1]=e("div",{class:"chatl",style:{width:"60px"}},[e("img",{class:"chatavator",src:y,alt:"",style:{width:"60px",height:"60px","border-radius":"50%"}})],-1))])):(d(),i("div",P,[t[2]||(t[2]=e("div",{class:"chatl",style:{width:"60px"}},[e("img",{class:"chatavator",src:y,alt:"",style:{width:"60px",height:"60px","border-radius":"50%"}})],-1)),e("div",q,[e("div",A,p(l.userName),1),e("div",Q,p(l.content),1)])]))])]))),128))],512)]),e("div",R,[e("div",X,[F(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>r.value=l),onKeypress:k,type:"text",placeholder:"Type your message...",class:"message-input"},null,544),[[M,r.value]])]),e("div",{class:"footright",style:{"justify-content":"right","padding-left":"2%"}},[e("button",{onClick:g,class:"send-button"},"发送消息")])])]))}},ae=w(Y,[["__scopeId","data-v-a13cff8a"]]);export{ae as default};
